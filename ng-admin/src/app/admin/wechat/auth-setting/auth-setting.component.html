<!--component html goes here -->
<nz-tabset>
    <nz-tab>
        <ng-template #nzTabHeading>
            微信配置
        </ng-template>
        <nz-card>
            <form nz-form [formGroup]="form" id="frm_create_role" (ngSubmit)="save(modelContent)">
                <ng-template #modelContent>
                    <h2>修改之后可能导致微信公众号不能使用，是否继续?</h2>
                </ng-template>

                <div nz-row>
                    <div nz-col [nzSpan]="16">
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="name" nz-form-item-required>微信号名称</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('name')">
                                <nz-input formControlName="name" [(ngModel)]="authSet.name" [nzId]="'name'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('name').dirty&&getFormControl('name').hasError('maxlength')">字符长度小于等于50</div>
                                <div nz-form-explain *ngIf="getFormControl('name').dirty&&getFormControl('name').hasError('required')">请输入微信号名称</div>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="appOrgId" nz-form-item-required>微信原始ID</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('appOrgId')">
                                <nz-input formControlName="appOrgId" [(ngModel)]="authSet.appOrgId" [nzId]="'appOrgId'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('appOrgId').dirty&&getFormControl('appOrgId').hasError('maxlength')">字符长度小于等于250</div>
                                <div nz-form-explain *ngIf="getFormControl('appOrgId').dirty&&getFormControl('appOrgId').hasError('required')">请输入微信原始ID</div>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="appType" nz-form-item-required>微信类型</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('appType')">

                                <nz-radio-group formControlName="appType" [(ngModel)]="authSet.appType" class="mb-md">
                                    <label nz-radio [nzValue]="o.value" *ngFor="let o of appTypes">
                                        <span>{{o.text}}</span>
                                    </label>
                                </nz-radio-group>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="appId" nz-form-item-required>微信AppID</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('appId')">
                                <nz-input formControlName="appId" [(ngModel)]="authSet.appId" [nzId]="'appId'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('appId').dirty&&getFormControl('appId').hasError('maxlength')">字符长度小于等于250</div>
                                <div nz-form-explain *ngIf="getFormControl('appId').dirty&&getFormControl('appId').hasError('required')">请输入微信AppID</div>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="appSecret" nz-form-item-required>微信AppSecret</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('appSecret')">
                                <nz-input formControlName="appSecret" [(ngModel)]="authSet.appSecret" [nzId]="'appSecret'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('appSecret').dirty&&getFormControl('appSecret').hasError('maxlength')">字符长度小于等于250</div>
                                <div nz-form-explain *ngIf="getFormControl('appSecret').dirty&&getFormControl('appSecret').hasError('required')">请输入微信AppSecret</div>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="encodingAESKey">微信EncodingAESKey</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('encodingAESKey')">
                                <nz-input formControlName="encodingAESKey" [(ngModel)]="authSet.encodingAESKey" [nzId]="'encodingAESKey'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('encodingAESKey').dirty&&getFormControl('encodingAESKey').hasError('maxlength')">字符长度小于等于500</div>
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="qrCodeUrl">微信二维码图片URL</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('qrCodeUrl')">
                                <!--<img [src]="authSet.qrCodeUrl" >-->
                                <img src="{{authSet.qrCodeUrl}}">
                                <!-- <img src="./assets/img/weixin.jpg"> -->
                            </div>
                        </div>
                        <div nz-form-item nz-row>
                            <div nz-form-label nz-col [nzSm]="5">
                                <label for="token" nz-form-item-required>微信Token</label>
                            </div>
                            <div nz-form-control nz-col [nzSm]="19" nzHasFeedback [nzValidateStatus]="getFormControl('token')">
                                <nz-input formControlName="token" [(ngModel)]="authSet.token" [nzId]="'token'"></nz-input>
                                <div nz-form-explain *ngIf="getFormControl('token').dirty&&getFormControl('token').hasError('maxlength')">字符长度小于等于250</div>
                                <div nz-form-explain *ngIf="getFormControl('token').dirty&&getFormControl('token').hasError('required')">请输入角色显示名</div>
                            </div>
                        </div>

                        <div nz-form-item nz-row class="mb0">
                            <div nz-form-label nz-col [nzSm]="5">
                                <!-- <button nz-button [nzType]="'default'" [nzSize]="'large'" type="button" (click)="handleCancel($event)">
                    {{l("取消")}}
                </button> -->
                                <button nz-button [nzType]="'primary'" [nzSize]="'large'" type="submit" [nzLoading]="authLoading" >
                                    {{l("保存")}}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </nz-card>
    </nz-tab>
    <nz-tab>
        <ng-template #nzTabHeading>
            微信分组
        </ng-template>
        <nz-card [nzBordered]="false">
            <form nz-form (ngSubmit)="refreshData(false,true)" [nzLayout]="'inline'">
                <div nz-row [nzGutter]="24">
                    <ng-template #deleteContent>
                        <h2>是否删除{{groupName}}组?</h2>
                    </ng-template>
                    <!-- <div nz-col [nzSpan]="8" class="mb-md">
                        <div nz-form-item class="d-flex">
                            <div nz-form-label>
                                <label>组名</label>
                            </div>
                            <div nz-form-control class="flex-1">
                                <nz-input [(ngModel)]="search.name" name="no" [nzSize]="'large'" [nzPlaceHolder]="'请输入组名'" nzId="no"></nz-input>
                            </div>
                        </div>
                    </div> -->

                    <div nz-col [nzSpan]="8" class="mb-md" [class.text-right]="'true'">
                        <!-- <button nz-button type="submit" [nzType]="'primary'" [nzLoading]="loading" [nzSize]="'large'">查询</button>
                        <button nz-button type="reset" (click)="refreshData(true)" [nzSize]="'large'" class="mx-sm">重置</button> -->
                        <button nz-button type="button" [nzType]="'primary'" (click)="createWeChatGroup()" [nzSize]="'large'">
                            <i class="anticon anticon-plus"></i>
                            <span>新建分组</span>
                        </button>
                        <button nz-button type="button" [nzType]="'primary'" (click)="batchMark()" [nzSize]="'large'" [nzLoading]="grouploading">
                            <span>将用户组同步到微信</span>
                        </button>
                    </div>
                </div>
            </form>
            <nz-table #nzTable [nzAjaxData]="weChatGroups" [nzTotal]="query.total" [(nzPageIndex)]="query.pageIndex" [(nzPageSize)]="query.pageSize" [nzLoading]="loading" [nzShowSizeChanger]="true" [nzShowTotal]="'true'" (nzPageIndexChange)="refreshData()" (nzPageSizeChange)="refreshData()">
                <thead nz-thead>
                    <tr>
                        <th nz-th>
                            <span>微信组名</span>
                        </th>
                        <th nz-th>
                            <span>用户类型</span>
                        </th>
                        <th nz-th>
                            <span>操作</span>
                        </th>
                    </tr>
                </thead>
                <tbody nz-tbody>
                    <tr nz-tbody-tr *ngFor="let weChatGroup of nzTable.data">
                        <td nz-td>{{weChatGroup.typeName}}</td>
                        <td nz-td>{{weChatGroup.tagName}}</td>
                        <td nz-td>
                            <a (click)="editWeChatGroup(weChatGroup)">编辑</a>
                            <span nz-table-divider></span>
                            <a (click)="delete(weChatGroup,deleteContent)">删除</a>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </nz-card>
        <wechat-group-create #createWeChatGroupModal (modalSave)="refreshData()"></wechat-group-create>
        <wechat-group-edit #editWeChatGroupModal (modalSave)="refreshData()"></wechat-group-edit>
    </nz-tab>
</nz-tabset>